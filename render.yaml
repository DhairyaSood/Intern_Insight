services:
  # Backend API Service
  - type: web
    name: pm-intern-backend
    env: python
    plan: free
    region: oregon
    buildCommand: bash build.sh
    startCommand: gunicorn -w 3 -k gthread -t 120 -b 0.0.0.0:$PORT wsgi:app
    envVars:
      - key: FLASK_ENV
        value: production
      - key: LOG_LEVEL
        value: INFO
      # MongoDB Atlas connection string; set in Render dashboard or here if non-secret
      - key: MONGO_URI
        sync: false
      - key: DB_NAME
        value: internship_recommender
      - key: DISABLE_JSON_FALLBACK
        value: "True"
      # Security keys (set in Render dashboard)
      - key: SECRET_KEY
        sync: false
      - key: JWT_SECRET_KEY
        sync: false
      # CORS origins for your frontend URL(s), comma-separated
      - key: CORS_ORIGINS
        value: "https://intern-insight-n1wn.onrender.com,https://pm-intern-fobb.onrender.com,http://localhost:3000"
      # Session cookie settings (if serving frontend on different domain use None + Secure)
      - key: SESSION_COOKIE_SAMESITE
        value: None
      - key: SESSION_COOKIE_SECURE
        value: "True"

  # Frontend Static Site
  - type: web
    name: pm-intern-frontend
    env: static
    plan: free
    region: oregon
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: ./frontend/build
    envVars:
      - key: REACT_APP_API_BASE_URL
        value: https://pm-intern-fobb.onrender.com/api
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
